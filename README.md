Сервис генерации коротких ссылок

Данный документ содержит сжатую информацию о микросервисе Short Link Service, описывая его архитектуру, методы запуска и ключевую бизнес-логику.

1. Архитектура и Компоненты

Сервис использует многоуровневую архитектуру (Controller, Service, Repository) с добавлением планировщика для фонового обслуживания.

Компонент

Ключевая Роль

LinkController

API-интерфейс (POST/GET). Обрабатывает запросы, управляет Cookie (SHORTLINK_USER) и заголовком X-User-ID.

ShortLinkService

Основная бизнес-логика: генерация кода, проверка коллизий (до 6 попыток), проверка условий редиректа.

CleanupScheduler

Фоновая задача (Cron). Периодически деактивирует просроченные ссылки и удаляет их из БД.

NotificationService

Отправка уведомлений пользователю о деактивации ссылки (истек TTL или лимит кликов).

2. Настройка и Запуск

Проект собирается и запускается с помощью Maven, используя конфигурацию в application.properties.

Критическая Конфигурация

В application.properties необходимо задать:

app.base-url=http://localhost:8080/
app.ttl=24 # Время жизни ссылки по умолчанию в часах (24 часа)


Запуск через Maven

# Сборка проекта
mvn clean install

# Запуск приложения
mvn spring-boot:run


3. Детали Бизнес-Логики

Создание Ссылки (POST /shorten)

Идентификация Пользователя: Если заголовок X-User-ID отсутствует, генерируется новый UUID и устанавливается в Cookie.

Генерация Кода: Используется ShortCodeGenerator для создания уникального 6-символьного кода. При коллизии выполняется до 5 повторных попыток.

Жизненный Цикл: Устанавливается срок действия (expiresAt) на основе app.ttl и сохраняется лимит кликов (maxClicks).

Перенаправление (GET /{code})

Поиск: Ищет ссылку по коду. Если не найдена, возвращает 404.

Проверки: Выполняются строгие проверки:

Ссылка неактивна (isActive = false)? -> Отказ.

Истек срок действия (expiresAt)? -> Деактивировать, уведомить пользователя и отказать.

Достигнут лимит кликов (clicks >= maxClicks)? -> Деактивировать, уведомить пользователя и отказать.

Переход: Если все проверки пройдены, счетчик кликов атомарно увеличивается, и выполняется перенаправление (302) на originalUrl.